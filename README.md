Transient Time Correlation Function (TTCF)
==========================================
    
This code is intended to runs LAMMPS to get a mother trajectory and then take a range of mirrored child trajectories as required for the TTCF method. 
The batch running is done using SimWrapPy, which should be automatically downloaded (from https://github.com/edwardsmith999/SimWrapPy)

The first aim is to match the work of Bernardi et al (2012) (https://doi.org/10.1063/1.4746121), before moving to more complex systems.
The case is Couette flow, which is set up by creating a set of imaginary atoms which act as tethering sites.
These do not interact with the system except to apply a force to the wall atom they are tethered to. 
These sites then slide and pull the walls as required for Couette flow. 
The liquid domain is set to have a size y, a wall region "wallwidth" is then added to top and bottom and a buffer which is empty to prevent tethered molecule from leaving the domain.
A Langevin thermostat is applied to the outer part of the walls to remove the heat generated by shearing.

Quickstart
===========

Mother
------

First of all, we need to create the mother trajectory. We need to copy the LAMMPS executable to the current directory (or add to path). We will assume this is called lmp,


    mpiexec -n 1 ./lmp -in mother.in

This will run equilibration for 100000 steps and then loops in blocks of 300 creating the starting point for the child trajectories to branch off. 
This can be seen in bottom of the mother.in as follows,


    #Equilibration
    run	           100000
    write_data output_equil.dat

    #Loop over lots of input cases
    label loop
    variable index loop 1000

        run	           300
        write_data output*.dat
        
    next index
    jump SELF loop

The rest of the file sets up a Couette flow example, so this can be changed as needed to any other system setup.

Children
--------

We then run a batch run starting from each of these trajectories (and its mirror) to create child runs using python code with simwraplib. You will need numpy installed then run.

    python run_children.py

Tested with python 2.7. The number of jobs running in parallel can be set by changing 

    #Number of processors to use
    ncpus = 6

in run_children.py. This creates a folder called study which has each of the child runs with a file called 
output.txt. The content of this is set in child.in


Post Process
------------
Each of the child trajectories creates data in the study folder, the final result can be obtained by running

    analyse_data.py

which loops over the ttcf folders in the study directory and tries to average all of them.
The output currently looks like this,

![alt text](https://raw.githubusercontent.com/ImperialCollegeLondon/TTCF/master/TTCF_out.png)


Note there is an optional output can be switched on in mother,

    fix		        6 all ave/chunk 5 40 1000 layers density/mass vx temp  c_stress[1] c_stress[2]  c_stress[3]  c_stress[4] file profile.wall.2d

which can be plotted using

    python plot_chunks.py 

to check the system is evolving as expected.

To Do
=====

 - The calculation of Pxy and dissipation function are not correct
 - The mother trajectory when we take a "brach" must be matched to the child trajectory
 - Match results of Bernardi et al (2012) (https://doi.org/10.1063/1.4746121)
